import{c as N,f as D,j as e,u as L,r as w}from"./main-2c13c5c7.js";import{t as g,m as X,n as B,o as k,p as E,q as H,r as $,s as b,v as M,w as v,x as F,y as R,z as P,A as V,D as q,E as U,F as Y,G,H as J,I as K,K as Q,N as W,Q as Z,R as ee,T as se,U as te,X as C,S as I,B as S,M as ae,c as re,d as ne,e as ce,f as le,u as ie,l as oe,L as de}from"./badge-0b34ca58.js";import{B as x,a as ue,I as he,c as fe}from"./loading-spinner-9c8a626e.js";import{E as me}from"./ellipsis-vertical-36a38d3f.js";import{P as xe}from"./package-fc4680fc.js";import"./user-2e4b218b.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],A=N("CircleAlert",je);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],T=N("CircleCheckBig",ge);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],_=N("Info",Ne);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],De=N("SquareCheckBig",ye);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],pe=N("Trash2",ve);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],z=N("TriangleAlert",we);function p(n,a){const t=+g(n)-+g(a);return t<0?-1:t>0?1:t}function be(n){return X(n,Date.now())}function Me(n){return a=>{const l=(n?Math[n]:Math.trunc)(a);return l===0?0:l}}function ke(n,a){return+g(n)-+g(a)}function Ce(n,a){const t=g(n,a==null?void 0:a.in);return t.setHours(23,59,59,999),t}function Ie(n,a){const t=g(n,a==null?void 0:a.in);return+Ce(t,a)==+B(t,a)}function Se(n,a,t){const[l,r,d]=k(t==null?void 0:t.in,n,n,a),o=p(r,d),c=Math.abs(E(r,d));if(c<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-o*c);let s=p(r,d)===-o;Ie(l)&&c===1&&p(l,d)===1&&(s=!1);const u=o*(c-+s);return u===0?0:u}function Ae(n,a,t){const l=ke(n,a)/1e3;return Me(t==null?void 0:t.roundingMethod)(l)}function Te(n,a,t){const l=H(),r=(t==null?void 0:t.locale)??l.locale??$,d=2520,o=p(n,a);if(isNaN(o))throw new RangeError("Invalid time value");const c=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:o}),[s,u]=k(t==null?void 0:t.in,...o>0?[a,n]:[n,a]),h=Ae(u,s),j=(b(u)-b(s))/1e3,i=Math.round((h-j)/60);let m;if(i<2)return t!=null&&t.includeSeconds?h<5?r.formatDistance("lessThanXSeconds",5,c):h<10?r.formatDistance("lessThanXSeconds",10,c):h<20?r.formatDistance("lessThanXSeconds",20,c):h<40?r.formatDistance("halfAMinute",0,c):h<60?r.formatDistance("lessThanXMinutes",1,c):r.formatDistance("xMinutes",1,c):i===0?r.formatDistance("lessThanXMinutes",1,c):r.formatDistance("xMinutes",i,c);if(i<45)return r.formatDistance("xMinutes",i,c);if(i<90)return r.formatDistance("aboutXHours",1,c);if(i<M){const f=Math.round(i/60);return r.formatDistance("aboutXHours",f,c)}else{if(i<d)return r.formatDistance("xDays",1,c);if(i<v){const f=Math.round(i/M);return r.formatDistance("xDays",f,c)}else if(i<v*2)return m=Math.round(i/v),r.formatDistance("aboutXMonths",m,c)}if(m=Se(u,s),m<12){const f=Math.round(i/v);return r.formatDistance("xMonths",f,c)}else{const f=m%12,y=Math.trunc(m/12);return f<3?r.formatDistance("aboutXYears",y,c):f<9?r.formatDistance("overXYears",y,c):r.formatDistance("almostXYears",y+1,c)}}function O(n,a){return Te(n,be(n),a)}function _e(){const{markAllAsRead:n,deleteAllReadNotifications:a,getFilteredNotifications:t}=D(),l=t(),r=l.some(o=>!o.read),d=l.some(o=>o.read);return e.jsxs(F,{children:[e.jsx(R,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsx(P,{className:"w-48 p-2",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:n,disabled:!r,className:"flex w-full items-center justify-start",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Mark all as read"]}),e.jsxs(V,{children:[e.jsx(q,{asChild:!0,children:e.jsxs(x,{variant:"ghost",size:"sm",disabled:!d,className:"flex w-full items-center justify-start text-destructive hover:bg-destructive/10",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Delete read"]})}),e.jsxs(U,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Delete read notifications"}),e.jsx(J,{children:"This action cannot be undone. This will permanently delete all read notifications."})]}),e.jsxs(K,{children:[e.jsx(Q,{children:"Cancel"}),e.jsx(W,{onClick:a,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})})]})}function ze(){var m,f;const n=L(),{selectedNotificationId:a,isDetailsDialogOpen:t,getNotificationById:l,markAsRead:r,deleteNotification:d,setSelectedNotificationId:o,setIsDetailsDialogOpen:c}=D(),s=a?l(a):null;w.useEffect(()=>{t&&a&&s&&!s.read&&r(a)},[t,a,s,r]);const u=()=>{o(null),c(!1)},h=()=>{s&&(d(s._id),u())},j=()=>{s!=null&&s.orderId?(n(`/orders/${s.orderId}`),u()):s!=null&&s.jobSiteId&&(n(`/job-sites/${s.jobSiteId}`),u())},i=y=>{switch(y){case"info":return e.jsx(_,{className:"h-6 w-6 text-blue-500"});case"success":return e.jsx(T,{className:"h-6 w-6 text-green-500"});case"warning":return e.jsx(z,{className:"h-6 w-6 text-yellow-500"});case"error":return e.jsx(A,{className:"h-6 w-6 text-red-500"})}};return s?e.jsx(Z,{open:t,onOpenChange:u,children:e.jsxs(ee,{className:"max-h-[90vh] max-w-2xl",children:[e.jsx(se,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{className:"text-xl font-semibold",children:"Notification Details"}),e.jsx(x,{variant:"ghost",size:"icon",onClick:u,children:e.jsx(C,{className:"h-5 w-5"})})]})}),e.jsx(I,{className:"max-h-[calc(90vh-8rem)]",children:e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i(s.type),e.jsx("h3",{className:"text-xl font-semibold",children:s.title})]}),e.jsx(S,{variant:s.read?"secondary":"default",children:((m=s==null?void 0:s.type)==null?void 0:m.charAt(0).toUpperCase())+((f=s==null?void 0:s.type)==null?void 0:f.slice(1))})]}),e.jsx("div",{className:"rounded-lg bg-muted/50 p-4",children:e.jsx("p",{className:"text-sm",children:s.message})}),e.jsx("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:e.jsx("span",{children:O(new Date(s.createdAt),{addSuffix:!0})})}),(s.orderId||s.jobSiteId)&&e.jsx(x,{className:"w-full",onClick:j,children:s.orderId?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"View Order Details"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"View Job Site Details"]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(x,{variant:"outline",onClick:h,className:"text-destructive hover:bg-destructive/10",children:"Delete"}),e.jsx(x,{variant:"outline",onClick:u,children:"Close"})]})]})})]})}):null}function Oe(){const{getFilteredNotifications:n,isLoading:a,deleteNotification:t,setSelectedNotificationId:l,setIsDetailsDialogOpen:r}=D(),d=n();if(a)return e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(ue,{size:40})});if(d.length===0)return e.jsx("div",{className:"mt-8 text-center text-gray-500",children:"No notifications found"});const o=s=>{switch(s){case"info":return e.jsx(_,{className:"h-5 w-5 text-blue-500"});case"success":return e.jsx(T,{className:"h-5 w-5 text-green-500"});case"warning":return e.jsx(z,{className:"h-5 w-5 text-yellow-500"});case"error":return e.jsx(A,{className:"h-5 w-5 text-red-500"})}},c=s=>{l(s),r(!0)};return e.jsx(I,{className:"h-[80vh] flex flex-col gap-2",children:d.map((s,u)=>{var h,j;return e.jsxs(re,{className:` mb-2 ${s.read?"opacity-60":""} ${s.orderId||s.jobSiteId?"cursor-pointer hover:bg-accent/50 transition-colors":""}`,onClick:()=>(s.orderId||s.jobSiteId)&&c(s._id),children:[e.jsxs(ne,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(ce,{className:"flex items-center text-sm font-medium",children:[o(s.type),e.jsx("span",{className:"ml-2",children:s.title})]}),e.jsx(S,{variant:s.read?"secondary":"default",children:((h=s==null?void 0:s.type)==null?void 0:h.charAt(0).toUpperCase())+((j=s==null?void 0:s.type)==null?void 0:j.slice(1))})]}),e.jsxs(le,{children:[e.jsx("p",{className:"mb-4 text-sm text-gray-500",children:s.message}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-400",children:O(new Date(s.createdAt),{addSuffix:!0})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:i=>{i.stopPropagation(),t(s._id)},children:"Delete"})]})]})]},s._id+u)})})}function Le(){const{searchTerm:n,setSearchTerm:a}=D(),[t,l]=w.useState(n),r=ie(t,300);w.useEffect(()=>{a(r)},[r,a]);const d=()=>{l(""),a("")};return e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(oe,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"}),e.jsx(he,{type:"text",placeholder:"Search notifications...",value:t,onChange:o=>l(o.target.value),className:fe("pl-8",t&&"pr-8")}),t&&e.jsx(x,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 transform p-1 hover:bg-transparent",onClick:d,children:e.jsx(C,{className:"h-4 w-4 text-muted-foreground hover:text-foreground"})})]})}function Re(){const{fetchNotifications:n}=D();return w.useEffect(()=>{n()},[n]),e.jsx(de,{children:e.jsxs("div",{className:"container mx-auto space-y-6 p-4 md:p-8 md:pt-6 max-h-[calc(100vh-12rem)]",children:[e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Notifications"}),e.jsx(_e,{})]})}),e.jsx(Le,{}),e.jsx(Oe,{}),e.jsx(ze,{})]})})}export{Re as Notifications};
